<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>HexJS Unit Testing</title>
        <script src="../build/hex-min.js"></script>
        <script src="http://static.edgar.im/sys/jquery/jquery.js"></script>
        <script>
            /**
             * @module hexjs-test
             * */
            hexjs.define( 'hexjs-test', function( require, exports, module ){
                
                var $result = jQuery('#test-result');
                
                var createItem = function( inner, color ){
                    jQuery('<li style="color:'+color+'"/>').html(inner).appendTo($result);
                };
                
                exports.print = function( msg, fn ){
                    if ( !!msg ){
                        createItem( fn + ' pass.', 'green' );
                    } else {
                        createItem( fn + ' fail.', 'red' );
                    }
                };
                
            } );


            /**
             * @module register-ready
             * */
            hexjs.define( 'register-ready', function( require, exports, module ){
                require('hexjs-test').print( true, 'register-ready' );
            } );


            /**
             * @module register-now
             * */
            hexjs.define( 'register-now', function( require, exports, module ){
                exports.isNow = !jQuery('#test-result').length;
            } );


            /**
             * @module register-multi
             * */
            hexjs.define( 'register-multi-a', function( require, exports, module ){
                require('hexjs-test').print( true, 'register-multi-a' );
            } );
            hexjs.define( 'register-multi-b', function( require, exports, module ){
                require('hexjs-test').print( true, 'register-multi-b' );
            } );
            hexjs.define( 'register-multi-c', function( require, exports, module ){
                !!window.console && console.info('register-multi-b pass.');
            } );


            /**
             * @module require
             * */
            hexjs.define( 'require', function( require, exports, module ){
                return require('hexjs-test')
            } );

            /**
             * @module require-refresh
             * */
            hexjs.define( 'require-refresh-pre', function( require, exports, module ){
                var variable = 1;
                exports.plus = function(){
                    variable++;
                    return variable;
                };
            } );
            hexjs.define( 'require-refresh', function( require, exports, module ){
                exports.variable = require('require-refresh-pre').plus();
            } );

            /**
             * @module exports
             * */
            hexjs.define( 'exports', function( require, exports, module ){
                exports.variable = 'exports';
            } );


            /**
             * @module return
             * */
            hexjs.define( 'return', function( require, exports, module ){
                return {
                    variable: 'return'
                }
            } );


            /**
             * @module return-cover-exports
             * */
            hexjs.define( 'return-cover-exports', function( require, exports, module ){
                exports.variable = 'exports';
                return {
                    variable: 'return-cover-exports'
                }
            } );


            /**
             * @module module-exports
             * */
            hexjs.define( 'module-exports', function( require, exports, module ){
                module.exports =  {
                    variable: 'module-exports'
                }
            } );


            /**
             * @module incoming-object
             * */
            hexjs.define( 'incoming-object', {
                init: function( require, exports, module ){
                    exports.variable = this._variable;
                },
                _variable: 'incoming-object'
                
            } );


            /**
             * @module module-id
             * */
            hexjs.define( 'module-id', function( require, exports, module ){
                exports.id = module.id;
            } );


            /**
             * @module module-constructor
             * */
            hexjs.define( 'module-constructor', function( require, exports, module ){
                var M = module.constructor;
                
                M.prototype.getId = function(){
                    return module.id;
                };
            } );
            
            
            /**
             * @module noConflict false
             * */
            hexjs.define( 'noConflict-false', function(){
                hexjs.noConflict(false);
            } );
            hexjs.define( 'noConflict-true', function(){
                hexjs.noConflict(true);
            } );
            hexjs.define( 'noConflict-undefined', function(){
                window.hexjsTemp = hexjs.noConflict();
            } );
            
            
            
            hexjs.register('register-ready');
            
            hexjs.define(function(require){
                require('register-now');
            }).register('~');
            
            hexjs.define(function(require){
                require('require').print( require('register-now').isNow, 'register-now');
            }).register();
            
            hexjs.register( ['register-multi-a','register-multi-b','register-multi-c'] );
            
            hexjs.define(function(require){
                require('require').print( true, 'require');
            } ).register();
            
            hexjs.define(function(require){
                require('hexjs-test').print( require('require-refresh').variable !== require('require-refresh',true).variable, 'require-refresh' );
            }).register();
            
            hexjs.define(function(require){
                require('hexjs-test').print( require('exports').variable === 'exports', 'exports');
            } ).register();
            
            hexjs.define(function(require){
                require('hexjs-test').print( require('return').variable === 'return', 'return');
            } ).register();
            
            hexjs.define(function(require){
                require('hexjs-test').print( require('return-cover-exports').variable === 'return-cover-exports', 'return-cover-exports');
            } ).register();
            
            hexjs.define(function(require){
                require('hexjs-test').print( require('module-exports').variable === 'module-exports', 'module-exports');
            } ).register();
            
            hexjs.define(function(require){
                require('hexjs-test').print( require('incoming-object').variable === 'incoming-object', 'incoming-object');
            } ).register();
            
            hexjs.define(function(require){
                require('hexjs-test').print( require('module-id').id === 'module-id', 'module-id');
            } ).register();
            
            hexjs.define(function(require, exports, module ){
                require('module-constructor');
                require('hexjs-test').print( module.getId() === 'module-constructor', 'module-constructor');
            } ).register();
            
            hexjs.define(function(require){
                hexjs.register('~noConflict-false');
                require('hexjs-test').print( define === hexjs.define && register === hexjs.register, 'noConflict-false' );
            }).register();
            
            hexjs.define(function(require){
                hexjs.register('~noConflict-true');
                require('hexjs-test').print( define !== hexjs.define && register !== hexjs.register, 'noConflict-true' );
                delete define;
                delete register;
            }).register();
            
            hexjs.define(function(require){
                hexjs.register('~noConflict-undefined');
                require('hexjs-test').print( hexjs === undefined, 'noConflict-undefined' );
                window.hexjs = hexjsTemp;
                delete hexjsTemp;
            }).register();
        </script>
    </head>
    <body style="width:800px;margin:0 auto;">
        <h1>HexJS Unit Testing</h1>
        <ul id="test-result">
            
        </ul>
        <script src="http://static.edgar.im/app/ga/org.js"></script>
    </body>
</html>
